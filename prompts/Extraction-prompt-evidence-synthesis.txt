EXTRACTION AGENT — EVIDENCE SYNTHESIS — v2 STRICT (schema-aligned, EN)

GOAL
Read the target PDF and emit exactly ONE JSON object that VALIDATES against the evidence_synthesis v2 schema. Use ONLY content from the PDF (including appendix/supplement within the same file).

EVIDENCE-LOCKED RULES
- No external knowledge. No inference or imputation.
- Priority: Methods/Results/Tables first; use Abstract only for verification or missing items.
- If information is absent in the PDF: OMIT the field. Never emit null.
- Every key quantitative datapoint must carry a SourceRef WHERE THE SCHEMA ALLOWS IT: minimally page; add table_id/figure_id and a short anchor/caption fragment when applicable. Only emit SourceRef for fields explicitly defined in the schema.

OUTPUT CONTRACT
- Emit exactly one JSON object. No markdown fences. No prose before/after.
- CLOSED WORLD ASSUMPTION: The schema uses "additionalProperties":false at ALL nesting levels. This means:
  * Only emit keys that are explicitly defined in the schema.
  * At the top level: only the ALLOWED TOP-LEVEL KEYS listed below are allowed.
  * Within nested objects (e.g., protocol, eligibility, outcomes, syntheses, publication_bias): only the keys defined in that schema fragment.
  * Any extra key will cause validation to FAIL.
- Numeric formatting: dot as decimal separator; no thousands separators; store percentages as numbers (e.g., 12.3).
- Confidence intervals: {"lower": <number>, "upper": <number>}.
- Dates: ISO-8601 if possible; preserve partial precision if only Y or Y-M is available.
- IDs (study_label, outcome_id, synthesis_id) must be stable and reused consistently.

CHARACTER ENCODING
- Use UTF-8 characters directly in JSON strings; do NOT use escape sequences
- Mathematical symbols: ≤, ≥, ±, ×, ÷, ≠, ≈, √ should appear as-is
- Greek letters: α, β, γ, δ, μ, σ, etc. should appear as-is
- Preserve special characters from PDF: don't convert ≤ to \u2264 or <=
- Example CORRECT: "levels": ["≤60", ">60"]
- Example WRONG: "levels": ["\u001460", ">60"] or "levels": ["<=60", ">60"]

ALLOWED TOP-LEVEL KEYS (closed set)
schema_version,
document,
study_id,
generator,           # optional but recommended
language,            # optional ISO code
metadata,
review_type,         # REQUIRED
protocol,            # optional (PROSPERO, protocol DOI)
living_review,       # optional (for living systematic reviews)
eligibility,         # REQUIRED (PICO structure)
search,              # REQUIRED (databases, dates)
prisma_flow,         # REQUIRED (study selection flow)
data_collection,     # optional (extraction methods, software)
included_studies,    # optional (characteristics of included studies)
outcomes,            # REQUIRED (≥1 outcome)
syntheses,           # REQUIRED (results per outcome)
risk_of_bias_summary,# optional (RoB assessment)
certainty_of_evidence,# optional (GRADE assessments)
publication_bias,    # optional (funnel plots, Egger test)
sensitivity_analyses,# optional
tables_parsed,
figures_summary,
prisma_reporting,    # optional (PRISMA checklist compliance)
amstar2_rating,      # optional (AMSTAR 2 quality assessment)
robis_assessment,    # optional (ROBIS tool for review quality)
extraction_warnings

DISALLOWED ANYWHERE
- Any extra keys not explicitly defined in the schema (top-level OR nested)
- correction_notes, _metadata, _pipeline_metadata (internal fields)
- Do NOT add source fields to objects that don't have them in the schema (e.g., publication_bias, data_collection)
- Do NOT add notes fields to objects that don't have them in the schema (e.g., robis_assessment)

SECTION REQUIREMENTS

metadata
- { title, authors[] (each with last_name REQUIRED; initials, given_names, orcid, affiliations, corresponding, email optional), journal, published_date (+ precision if available), volume/issue/pages if present }
- If vancouver_citation is emitted, also emit vancouver_source (SourceRef).

review_type
- REQUIRED. Must be ONE of:
  "Systematic review (no meta-analysis)"
  "Pairwise meta-analysis"
  "Network meta-analysis"
  "IPD meta-analysis"
  "Umbrella/Overview review"
  "Scoping review"

protocol
- { prospero_id, protocol_doi, deviations_from_protocol, registration, source }

living_review
- { is_living_review: true/false, version_number, version_date, update_schedule, trigger_criteria, version_history, changes_since_last_version, discontinuation }

eligibility
- REQUIRED. PICO structure:
  {
    population,               # REQUIRED (string)
    intervention_or_exposure, # REQUIRED (string)
    comparators,              # REQUIRED (string)
    outcomes,                 # REQUIRED (string)
    study_designs,            # REQUIRED (eligible primary study designs, e.g., "RCTs")
    setting,
    language_restrictions,
    timeframe,
    exclusion_criteria,
    source
  }

search
- REQUIRED:
  {
    databases[],              # REQUIRED (≥1 database)
    last_search_date,         # REQUIRED (ISO date)
    other_sources[],          # optional (trial registries, grey literature)
    search_strings[],         # optional (per-database search strategies)
    date_from,                # optional
    date_to,                  # optional
    deduplication_approach,
    source
  }

prisma_flow
- REQUIRED:
  {
    records_identified,       # REQUIRED (integer)
    studies_included,         # REQUIRED (integer)
    records_after_duplicates,
    records_screened,
    records_excluded,
    full_text_assessed,
    full_text_excluded,
    reasons_excluded[],
    prisma_figure              # SourceRef to PRISMA diagram
  }

data_collection
- {
    risk_of_bias_tool ∈ {"RoB2", "ROBINS-I", "Other", "Not reported"},
    effect_size_computation,
    unit_of_analysis_issues,
    multiplicity_strategy,
    software,
    double_extraction: true/false,
    adjudication_rate_pct,
    conversion_rules,
    unit_harmonization
  }
  NOTE: data_collection has NO source field in the schema.

included_studies
- Array of: {
    study_label,              # REQUIRED (e.g., "Smith 2020")
    design,
    n,
    doi,
    pmid,
    notes,
    source
  }

outcomes
- REQUIRED (≥1). Each: {
    outcome_id,               # REQUIRED
    name,                     # REQUIRED (NOT "label")
    type,                     # REQUIRED: "binary"|"continuous"|"time_to_event"|"ordinal"|"count"
    definition,
    direction_of_benefit ∈ {"higher_better"|"lower_better"|"neutral_or_na"},
    unit,
    timepoint,
    measurement_method,
    is_primary: true/false,
    source
  }

syntheses
- REQUIRED. Array of: {
    synthesis_id,
    type,                     # REQUIRED: "narrative"|"pairwise_meta"|"network_meta"|"ipd_meta"|"umbrella_summary"
    outcome_id,               # REQUIRED
    description,
    # For pairwise_meta:
    pooled_effect: { type, point, ci, p_value },
    heterogeneity: { I2_pct, tau2, tau, Q, df, p_Q, H, I2_ci: {lower, upper} },
    forest_plot_source,
    model ∈ {"fixed"|"random"},
    pooling_method,
    per_study_data[],         # { study_label, effect: {type, point, ci}, weight, source }
    # For network_meta - REQUIRED FIELDS:
    treatments: REQUIRED, array of treatment names (min 2 items),
    reference_treatment: REQUIRED, the reference/comparator treatment name,
    model: REQUIRED, one of "fixed" | "random" | "bayesian",
    pooled_effects: REQUIRED, array of { treatment_a, treatment_b, effect: {type, point, ci} },
    # Optional network_meta fields:
    ranking[]: { treatment, metric_name (e.g. "SUCRA"), value },
    consistency_assessment: { test_name, p_value, result },
    network_geometry,
    league_table_source,
    # For narrative:
    narrative_summary,
    source
  }

risk_of_bias_summary
- {
    tool ∈ {"RoB2"|"ROBINS-I"|"Other"},
    summary_text,
    fig_source,
    per_study_assessments[],  # { study_label, rob_assessment, weight_in_meta_analysis, source }
    overall_rob_distribution: { low_risk_pct, some_concerns_pct, high_risk_pct },
    source
  }

certainty_of_evidence
- Array of GRADE assessments per outcome: {
    outcome_id,
    overall_certainty ∈ {"high"|"moderate"|"low"|"very_low"},
    starting_level,
    downgrades: { risk_of_bias, inconsistency, indirectness, imprecision, publication_bias },
    upgrades: { large_effect, dose_response, plausible_confounding },
    narrative_summary,
    source
  }

publication_bias
- {
    funnel_plot_source,
    egger_test_p,
    trim_and_fill_applied: true/false,
    small_study_methods,
    p_curve_analysis: { p_curve_plot_source, evidential_value, test_for_right_skew_p, test_for_flatness_p },
    pet_peese: { pet_estimate, pet_p_value, peese_estimate, peese_p_value, recommended_estimate },
    selection_models: { model_type, adjusted_estimate, tau2_adjusted, notes },
    excess_significance_test: { observed_significant, expected_significant, p_value, evidence_of_bias },
    contour_enhanced_funnel: { plot_source, pattern_interpretation },
    notes
  }

sensitivity_analyses
- Array of sensitivity analyses. Each item REQUIRES these fields:
    analysis_type: REQUIRED, one of "leave_one_out" | "fixed_vs_random" | "alternative_effect_measure" | "risk_of_bias_restriction" | "imputation_method" | "outlier_exclusion" | "subgroup_exclusion" | "publication_year_restriction" | "other",
    outcome_id: REQUIRED, must reference an existing outcome_id from outcomes[],
    # Optional fields:
    description,
    result: { effect: {type, point, ci}, heterogeneity, conclusion_changed: true/false },
    source: { page, anchor }
  }

tables_parsed
- [{ table_id, title, page, type ∈ {"studies"|"results"|"bias"|"grade"|"other"}, columns[], rows[], notes, source }]

figures_summary
- REQUIRED: { figure_id, caption }. Include page if known.
- key_values: flat object with numeric values only.

prisma_reporting
- {
    version,
    claimed: true/false,
    checklist_available: true/false,
    items[]: { item_id, reported ∈ {"yes"|"partially"|"no"|"unclear"}, location, source },
    notes
  }

amstar2_rating
- {
    overall_confidence ∈ {"high"|"moderate"|"low"|"critically_low"},
    critical_weaknesses,
    non_critical_weaknesses,
    items[]: { item_number, question, response ∈ {"yes"|"partial_yes"|"no"}, notes },
    notes
  }

robis_assessment
- {
    overall_risk_of_bias ∈ {"low"|"high"|"unclear"},
    phase_1_relevance: { review_question_match, concerns },
    phase_2_domains: { study_eligibility_criteria, identification_and_selection, data_collection_and_study_appraisal, synthesis_and_findings },
    phase_3_overall_assessment
  }
  NOTE: robis_assessment has NO notes field in the schema.

extraction_warnings
- Array of objects (NOT strings):
  { code ∈ {"TABLE_PARSE_FAIL"|"AMBIGUOUS_UNIT"|"CI_PARSE_FAIL"|"MISSING_STUDY_ID"|"OTHER"}, message, source }

FINAL VALIDATION — PRE-FLIGHT CHECKLIST
1) Only allowed top-level keys; no nulls anywhere.
2) review_type is one of the 6 exact schema enum values (with parentheses and capitalization as shown).
3) eligibility has all 5 required fields: population, intervention_or_exposure, comparators, outcomes, study_designs.
4) search has databases[] (≥1) and last_search_date.
5) prisma_flow has records_identified and studies_included (both integers).
6) outcomes ≥1; each has outcome_id, name, type.
7) syntheses array present (even if empty for narrative-only reviews); each has type, outcome_id.
8) Synthesis type is one of: "narrative", "pairwise_meta", "network_meta", "ipd_meta", "umbrella_summary".
9) Heterogeneity uses field names: I2_pct, tau2, tau, Q, p_Q (not mathematical notation).
10) Every SourceRef has at least {page} and concise anchor.
11) If metadata.vancouver_citation present, metadata.vancouver_source also present.
12) No disallowed keys anywhere.
13) Special characters (≤, ≥, ±, ×, etc.) appear as UTF-8 characters, NOT escape sequences (\u2264) or ASCII alternatives (<=).

OUTPUT
- Emit exactly one JSON object that validates against the evidence_synthesis v2 schema. No extra text.
