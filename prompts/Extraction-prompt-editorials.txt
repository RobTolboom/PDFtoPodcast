EXTRACTION AGENT — EDITORIALS & OPINION — v2 STRICT (schema-aligned, EN)

GOAL
Read the target PDF and emit exactly ONE JSON object that VALIDATES against the editorials_opinion v2 schema. Use ONLY content from the PDF (including appendix/supplement within the same file).

EVIDENCE-LOCKED RULES
- No external knowledge. No inference or imputation.
- Priority: Main text/Discussion first; use Abstract only for verification or missing items.
- If information is absent in the PDF: OMIT the field. Never emit null.
- Every key argument or standpoint must carry a SourceRef (as allowed by the schema): minimally page; add anchor (e.g., paragraph/section).
- Preserve quotes verbatim as reported in the text.
- Parse figures/tables if present and include in tables_parsed[]/figures_summary[] with source.

OUTPUT CONTRACT
- Emit exactly one JSON object. No markdown fences. No prose before/after.
- Closed world: only the TOP-LEVEL KEYS listed below are allowed.
- Stable IDs (claim_id) must be reused consistently.

ALLOWED TOP-LEVEL KEYS (closed set)
schema_version,
document,
study_id,
generator,                # optional but recommended
language,                 # optional ISO code
metadata,
article_type,             # REQUIRED
peer_review_status,       # optional
invited,                  # optional boolean
editorial_context,        # optional
target_article,           # optional
topic_keywords,           # optional
stance_overall,           # REQUIRED
thesis_statement,         # optional
key_points,               # optional
arguments,                # REQUIRED (≥1 argument)
recommendations,          # optional
notable_quotes,           # optional
limitations_or_bias,      # optional
conflict_of_interest,     # optional
response_chain,           # optional
impact_metrics,           # optional
quality_assessment,       # optional
digital_features,         # optional
tables_parsed,
figures_summary,
extraction_warnings,
truncated

DISALLOWED ANYWHERE
- Any extra keys not explicitly defined in the schema (top-level OR nested)
- correction_notes, _metadata, _pipeline_metadata (internal fields)

SECTION REQUIREMENTS

document
- { filename, content_type, page_count }

metadata
- { title, authors[], journal, published_date (+ precision if available), volume/issue/pages if present }
- If vancouver_citation is emitted, also emit vancouver_source (SourceRef).

article_type
- REQUIRED. Must be ONE of (exact capitalization):
  "Editorial"
  "Commentary"
  "Perspective"
  "Viewpoint"
  "Opinion"
  "Letter"
  "Reply"
  "News & Views"
  "Invited Commentary"
  "Other"

peer_review_status
- Optional enum: "peer_reviewed" | "not_peer_reviewed" | "unknown"

invited
- Optional boolean: true/false (whether the editorial was invited)

editorial_context
- Optional: { editorial_board_member, guest_editor, solicited, editorial_type ∈ {"accompanying"|"standalone"|"response"|"invited"|"unsolicited"}, publication_timeline, editorial_process }

target_article
- Optional: if the editorial comments on a specific article
- { title, pmid, doi, citation_text, url, type ∈ {"primary_study"|"review"|"guideline"|"policy"|"other"}, source }

topic_keywords
- Optional array of strings

stance_overall
- REQUIRED. Overall stance of the author(s):
  "supportive" | "critical" | "mixed" | "neutral" | "unclear"

thesis_statement
- Optional: one-sentence summary of the main thesis/position

key_points
- Optional array of strings: main points made

arguments
- REQUIRED (≥1). Each: {
    claim_id,                  # REQUIRED (stable ID)
    text,                      # REQUIRED (the argument/claim text)
    stance ∈ {"pro"|"con"|"neutral"|"unclear"},  # per individual argument
    evidence_type ∈ {"primary_study"|"systematic_review"|"guideline"|"expert_opinion"|"anecdote"|"data_analysis"|"none"|"other"},
    cited_refs[],              # Array of CitedRef objects
    evidence_links[],          # Array of LinkedEvidence
    support_strength,          # Free-text assessment (e.g., strong, limited, speculative)
    counterarguments[],        # Array of strings
    rhetorical_analysis,       # Optional RhetoricalAnalysis object
    bias_indicators,           # Optional BiasIndicators object
    logical_structure,         # Optional LogicalStructure object
    source                     # SourceRef
  }
- NOTE: Use "text" NOT "claim" for the argument statement; use "claim_id" NOT "argument_id"
- stance for arguments is: pro/con/neutral/unclear (NOT supportive/critical)

recommendations
- Optional array. Each: {
    area ∈ {"clinical_practice"|"policy"|"research"|"education"|"other"},  # REQUIRED
    statement,                 # REQUIRED (the recommendation text)
    urgency ∈ {"low"|"moderate"|"high"},
    target_audience,
    source
  }

notable_quotes
- Optional array: { text, context, source }

limitations_or_bias
- Optional string: any stated limitations or potential biases acknowledged by the authors

conflict_of_interest
- Optional: { declared, statement, financial_interests[], institutional_affiliations[], personal_relationships[], intellectual_interests[] }

response_chain
- Optional: { is_response, responds_to[], has_responses[], thread_position, thread_id }

impact_metrics
- Optional: { citation_metrics, altmetrics, policy_impact, expert_reception, longitudinal_impact }

quality_assessment
- Optional: { author_expertise, source_credibility, fact_checking, transparency, readability, overall_quality_score }

digital_features
- Optional: { multimedia_content, social_media_integration, version_control, peer_commentary, accessibility, real_time_updates }

tables_parsed
- [{ table_id, title, page, type ∈ {"baseline"|"outcomes"|"harms"|"methods"|"other"}, rows[], source }]

figures_summary
- REQUIRED: { figure_id, caption }. Include page if known.
- key_values: flat object with numeric values only.

extraction_warnings
- Array of objects (NOT strings):
  { code ∈ {"TABLE_PARSE_FAIL"|"AMBIGUOUS_UNIT"|"CI_PARSE_FAIL"|"MISSING_ARM_ID"|"MISSING_GROUP_ID"|"OTHER"}, message, source }

truncated
- If content was omitted due to limits: { value: true, reason: "token_limit" }

VANCOUVER-REFERENCE
- Capture all bibliographic fields in metadata: full author list, title, journal, published_date + published_date_precision, volume, issue, pages or article_number/elocation_id, DOI, PMID/PMCID, ISSN/eISSN, funding/COI.
- Create ONE vancouver_citation string based ONLY on PDF fields:
  - Authors: "LastName Initials" separated by commas; if >6 authors: first 6 + "et al."
  - Title exactly as in PDF.
  - Journal: use NLM abbreviation ONLY if literally present in PDF; otherwise full title.
  - Standard: `Authors. Title. Journal. Year;Volume(Issue):PageStart-PageEnd.`
  - Variations: no issue → `Year;Volume:PageStart-PageEnd.`; with article number → `Year;Volume:ArticleNumber.`; add `doi:DOI` if present; if ePub ahead of print: add `Epub YYYY Mon DD.`
- Set the source of the reference string in metadata.vancouver_source (SourceRef; e.g., anchor "How to cite this article", with page).

FINAL VALIDATION — PRE-FLIGHT CHECKLIST
1) Only allowed top-level keys; no nulls anywhere.
2) article_type is one of the exact schema enum values (capitalized, e.g., "Editorial" not "editorial").
3) stance_overall is one of: "supportive", "critical", "mixed", "neutral", "unclear".
4) arguments ≥1; each has claim_id and text (NOT argument_id and claim).
5) arguments[].stance uses: "pro", "con", "neutral", "unclear" (NOT supportive/critical).
6) arguments[].evidence_type uses correct enum: primary_study, systematic_review, guideline, expert_opinion, anecdote, data_analysis, none, other.
7) recommendations[].area uses correct enum: clinical_practice, policy, research, education, other.
8) tables_parsed type uses correct enum: baseline, outcomes, harms, methods, other.
9) Every SourceRef has at least {page} and concise anchor.
10) If metadata.vancouver_citation present, metadata.vancouver_source also present.
11) No disallowed keys anywhere.

OUTPUT
- Emit exactly one JSON object that validates against the editorials_opinion v2 schema. No extra text.
