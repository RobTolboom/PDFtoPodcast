{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "editorials_opinion.schema.json",
  "title": "Editorials & Opinion Extraction",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schema_version",
    "metadata",
    "article_type",
    "stance_overall",
    "arguments"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "pattern": "^v\\d+\\.\\d+(\\.\\d+)?$",
      "description": "Semantic-like version tag, e.g. v1.0 or v1.2.3"
    },
    "document": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "filename",
        "page_count"
      ],
      "properties": {
        "filename": {
          "type": "string"
        },
        "content_type": {
          "type": "string",
          "enum": [
            "application/pdf"
          ],
          "default": "application/pdf"
        },
        "size_bytes": {
          "type": "integer",
          "minimum": 0
        },
        "page_count": {
          "type": "integer",
          "minimum": 1
        }
      }
    },
    "study_id": {
      "type": "string",
      "pattern": "^[A-Za-z0-9._-]+$",
      "description": "Internal opaque ID for this article"
    },
    "generator": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "name",
        "model",
        "timestamp"
      ],
      "properties": {
        "name": {
          "type": "string"
        },
        "model": {
          "type": "string"
        },
        "temperature": {
          "type": "number"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "language": {
      "$ref": "#/$defs/LanguageCode"
    },
    "metadata": {
      "$ref": "#/$defs/Metadata"
    },
    "article_type": {
      "type": "string",
      "enum": [
        "Editorial",
        "Commentary",
        "Perspective",
        "Viewpoint",
        "Opinion",
        "Letter",
        "Reply",
        "News & Views",
        "Invited Commentary",
        "Other"
      ]
    },
    "peer_review_status": {
      "type": "string",
      "enum": [
        "peer_reviewed",
        "not_peer_reviewed",
        "unknown"
      ],
      "default": "unknown"
    },
    "invited": {
      "type": "boolean",
      "default": false
    },
    "target_article": {
      "$ref": "#/$defs/TargetArticle"
    },
    "topic_keywords": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "default": []
    },
    "stance_overall": {
      "type": "string",
      "enum": [
        "supportive",
        "critical",
        "mixed",
        "neutral",
        "unclear"
      ]
    },
    "thesis_statement": {
      "type": "string",
      "description": "One-sentence summary of the main thesis/position"
    },
    "key_points": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "default": []
    },
    "arguments": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Argument"
      },
      "minItems": 1
    },
    "recommendations": {
      "type": "array",
      "description": "Practice/policy/research recommendations, if any.",
      "items": {
        "$ref": "#/$defs/Recommendation"
      },
      "default": []
    },
    "notable_quotes": {
      "type": "array",
      "description": "Salient quotes from the piece.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "text"
        ],
        "properties": {
          "text": {
            "type": "string"
          },
          "context": {
            "type": "string"
          },
          "source": {
            "$ref": "#/$defs/SourceRef"
          }
        }
      },
      "default": []
    },
    "limitations_or_bias": {
      "type": "string",
      "description": "Any stated limitations or potential biases acknowledged by the authors"
    },
    "tables_parsed": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/ParsedTable"
      },
      "default": []
    },
    "figures_summary": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/FigureSummary"
      },
      "default": []
    },
    "extraction_warnings": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/ExtractionWarning"
      },
      "default": []
    },
    "truncated": {
      "$ref": "#/$defs/TruncationInfo"
    }
  },
  "$defs": {
    "CitedRef": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "citation_text": {
          "type": "string"
        },
        "pmid": {
          "type": "string",
          "pattern": "^\\d{1,8}$"
        },
        "doi": {
          "type": "string",
          "pattern": "^10\\.\\d{4,9}/[-._;()/:A-Za-z0-9]+$",
          "description": "DOI; pattern accepts upper- and lowercase letters"
        },
        "url": {
          "type": "string",
          "format": "uri"
        },
        "source": {
          "$ref": "#/$defs/SourceRef"
        }
      }
    },
    "TargetArticle": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "title": {
          "type": "string"
        },
        "pmid": {
          "type": "string",
          "pattern": "^\\d{1,8}$"
        },
        "doi": {
          "type": "string",
          "pattern": "^10\\.\\d{4,9}/[-._;()/:A-Za-z0-9]+$",
          "description": "DOI; pattern accepts upper- and lowercase letters"
        },
        "citation_text": {
          "type": "string"
        },
        "url": {
          "type": "string",
          "format": "uri"
        },
        "type": {
          "type": "string",
          "enum": [
            "primary_study",
            "review",
            "guideline",
            "policy",
            "other"
          ]
        },
        "source": {
          "$ref": "#/$defs/SourceRef"
        }
      }
    },
    "Argument": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "claim_id",
        "text"
      ],
      "properties": {
        "claim_id": {
          "type": "string"
        },
        "text": {
          "type": "string"
        },
        "stance": {
          "type": "string",
          "enum": [
            "pro",
            "con",
            "neutral",
            "unclear"
          ],
          "default": "neutral"
        },
        "evidence_type": {
          "type": "string",
          "enum": [
            "primary_study",
            "systematic_review",
            "guideline",
            "expert_opinion",
            "anecdote",
            "data_analysis",
            "none",
            "other"
          ],
          "default": "other"
        },
        "cited_refs": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/CitedRef"
          },
          "default": []
        },
        "support_strength": {
          "type": "string",
          "description": "Free-text assessment as stated by authors (e.g., strong, limited, speculative)"
        },
        "counterarguments": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "source": {
          "$ref": "#/$defs/SourceRef"
        }
      }
    },
    "Recommendation": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "area",
        "statement"
      ],
      "properties": {
        "area": {
          "type": "string",
          "enum": [
            "clinical_practice",
            "policy",
            "research",
            "education",
            "other"
          ]
        },
        "statement": {
          "type": "string"
        },
        "urgency": {
          "type": "string",
          "enum": [
            "low",
            "moderate",
            "high"
          ],
          "default": "moderate"
        },
        "target_audience": {
          "type": "string"
        },
        "source": {
          "$ref": "#/$defs/SourceRef"
        }
      }
    },
    "ExtractionWarning": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "code",
        "message"
      ],
      "properties": {
        "code": {
          "type": "string",
          "enum": [
            "TABLE_PARSE_FAIL",
            "AMBIGUOUS_UNIT",
            "CI_PARSE_FAIL",
            "MISSING_ARM_ID",
            "MISSING_GROUP_ID",
            "OTHER"
          ]
        },
        "message": {
          "type": "string"
        },
        "source": {
          "$ref": "#/$defs/SourceRef"
        }
      }
    },
    "FigureSummary": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "figure_id",
        "caption"
      ],
      "properties": {
        "figure_id": {
          "type": "string"
        },
        "caption": {
          "type": "string"
        },
        "key_values": {
          "type": "object",
          "additionalProperties": {
            "type": "number"
          },
          "default": {}
        },
        "page": {
          "type": "integer",
          "minimum": 1
        },
        "source": {
          "$ref": "#/$defs/SourceRef"
        }
      }
    },
    "LanguageCode": {
      "type": "string",
      "pattern": "^[a-z]{2}$",
      "description": "ISO 639-1 language code (e.g., 'en', 'nl')."
    },
    "Metadata": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "title",
        "journal"
      ],
      "properties": {
        "title": {
          "type": "string"
        },
        "journal": {
          "type": "string"
        },
        "journal_abbrev": {
          "type": "string"
        },
        "published_date": {
          "type": "string",
          "format": "date"
        },
        "published_date_precision": {
          "type": "string",
          "enum": [
            "year",
            "month",
            "day"
          ]
        },
        "volume": {
          "type": "string"
        },
        "issue": {
          "type": "string"
        },
        "pages": {
          "type": "string"
        },
        "page_start": {
          "type": "string"
        },
        "page_end": {
          "type": "string"
        },
        "article_number": {
          "type": "string"
        },
        "elocation_id": {
          "type": "string"
        },
        "issn": {
          "type": "string",
          "pattern": "^(\\d{4}-\\d{3}[\\dxX])$"
        },
        "eissn": {
          "type": "string",
          "pattern": "^(\\d{4}-\\d{3}[\\dxX])$"
        },
        "authors": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/Author"
          },
          "default": []
        },
        "pmid": {
          "type": "string",
          "pattern": "^\\d{1,8}$"
        },
        "pmcid": {
          "type": "string",
          "pattern": "^PMC\\d+$"
        },
        "doi": {
          "type": "string",
          "pattern": "^10\\.\\d{4,9}/[-._;()/:A-Za-z0-9]+$",
          "description": "DOI; pattern accepts upper- and lowercase letters"
        },
        "registration": {
          "$ref": "#/$defs/Registration"
        },
        "protocol_ref": {
          "type": "string"
        },
        "funding": {
          "type": "string"
        },
        "conflict_of_interest": {
          "type": "string"
        },
        "epub_ahead_of_print_date": {
          "type": "string"
        },
        "vancouver_citation": {
          "type": "string"
        },
        "vancouver_source": {
          "$ref": "#/$defs/SourceRef"
        },
        "source": {
          "$ref": "#/$defs/SourceRef"
        }
      }
    },
    "ParsedTable": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "table_id",
        "title"
      ],
      "properties": {
        "table_id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "page": {
          "type": "integer",
          "minimum": 1
        },
        "type": {
          "type": "string",
          "enum": [
            "baseline",
            "outcomes",
            "harms",
            "methods",
            "other"
          ]
        },
        "rows": {
          "type": "array",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "cells"
            ],
            "properties": {
              "cells": {
                "type": "array",
                "minItems": 1,
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "default": []
        },
        "source": {
          "$ref": "#/$defs/SourceRef"
        }
      }
    },
    "SourceRef": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "anchor": {
          "type": "string",
          "description": "Free-text pointer like 'Table 2', 'Fig 1', or sentence quote"
        },
        "page": {
          "type": "integer",
          "minimum": 1
        },
        "figure_id": {
          "type": "string"
        },
        "table_id": {
          "type": "string"
        }
      }
    },
    "TruncationInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "value": {
          "type": "boolean",
          "default": false
        },
        "reason": {
          "type": "string",
          "enum": [
            "token_limit",
            "page_limit",
            "timeout",
            "other"
          ]
        }
      }
    }
  }
}
